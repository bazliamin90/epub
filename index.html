 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>EPUB.js Viewer with Zoom & Font Size</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: monospace;
      background: #68fff2;
      overflow: hidden;
    }
    #controls {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .4rem .8rem;
      background: #000;
      color: #e8eaed;
      position: sticky;
      top: 0;
      z-index: 10;
      flex-wrap: wrap;
    }
    #controls input, #controls select, #controls button {
      background: #0b0d10;
      color: #e8eaed;
      border: 1px solid #222831;
      border-radius: .25rem;
      padding: .25rem .6rem;
      font-family: monospace;
      cursor: pointer;
    }
    #controls button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    #viewer {
      position: absolute;
      top: 45px;
      bottom: 0;
      left: 0;
      right: 0;
      overflow: auto;
      background: #fff;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      transform-origin: top left;
    }
  </style>
</head>
<body>
  <!-- Controls -->
  <div id="controls">
    <button id="prevPage">◀ Prev</button>
    <label>Page:
      <input type="number" id="pageInput" value="1" min="1" style="width:4rem">
    </label>
    <span id="pageCount">/ ?</span>
    <button id="nextPage">Next ▶</button>

    <label style="margin-left:1rem">Font Size:
      <select id="fontSize">
        <option value="80%">Small</option>
        <option value="100%" selected>Normal</option>
        <option value="120%">Large</option>
        <option value="150%">X-Large</option>
      </select>
    </label>

    <label style="margin-left:1rem">Zoom:
      <select id="zoomSelect">
        <option value="0.5">50%</option>
        <option value="1" selected>100%</option>
        <option value="1.5">150%</option>
        <option value="2">200%</option>
      </select>
    </label>
  </div>

  <!-- EPUB container -->
  <div id="viewer"></div>

  <!-- epub.js library -->
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
  <script>
    const book = ePub("The Sirah of the Prophet.epub");  // replace with your epub filename
    const rendition = book.renderTo("viewer", {
      width: "100%",
      height: "100%",
    });
    rendition.display();

    let locations = null;

    // Generate locations (acts like pages)
    book.ready.then(() => book.locations.generate(1000)) 
      .then(() => {
        locations = book.locations;
        document.getElementById("pageCount").textContent = "/ " + locations.total;
        document.getElementById("pageInput").max = locations.total;
      });

    // Track relocation
    rendition.on("relocated", (location) => {
      const currentPage = locations.locationFromCfi(location.start.cfi);
      document.getElementById("pageInput").value = currentPage;
      updateButtons(currentPage);
    });

    function updateButtons(page) {
      document.getElementById("prevPage").disabled = (page <= 1);
      document.getElementById("nextPage").disabled = (page >= locations.total);
    }

    // Navigation
    document.getElementById("prevPage").addEventListener("click", () => rendition.prev());
    document.getElementById("nextPage").addEventListener("click", () => rendition.next());

    // Jump to page
    document.getElementById("pageInput").addEventListener("change", (e) => {
      let page = parseInt(e.target.value, 10);
      if (page > 0 && page <= locations.total) {
        let cfi = locations.cfiFromLocation(page);
        rendition.display(cfi);
      } else {
        e.target.value = locations.locationFromCfi(rendition.currentLocation().start.cfi);
      }
    });

    // Font size
    document.getElementById("fontSize").addEventListener("change", (e) => {
      rendition.themes.fontSize(e.target.value);
    });

    // Zoom scaling
    document.getElementById("zoomSelect").addEventListener("change", (e) => {
      const scale = parseFloat(e.target.value);
      const iframe = document.querySelector("#viewer iframe");
      if (iframe) {
        iframe.style.transform = `scale(${scale})`;
        iframe.style.width = `${100 / scale}%`;  // prevent cutoff
        iframe.style.height = `${100 / scale}%`;
      }
    });

    // Mobile swipe
    rendition.on("rendered", () => {
      const iframe = document.querySelector("#viewer iframe");
      if (!iframe) return;
      let startX;
      const doc = iframe.contentWindow.document;
      doc.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      });
      doc.addEventListener("touchend", (e) => {
        let endX = e.changedTouches[0].clientX;
        if (startX - endX > 50) rendition.next();
        else if (endX - startX > 50) rendition.prev();
      });
    });
  </script>
</body>
</html>
